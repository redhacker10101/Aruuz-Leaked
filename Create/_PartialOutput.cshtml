@model IEnumerable<Aruuz.Models.scanOutputFuzzy>
@using Aruuz.Models

<script type="text/javascript">
    $(document).ready(function () {
        validate_create();
        $('[data-toggle="popover"]').popover({
            trigger: 'hover',
            'placement': 'top auto',
            'container': 'body',
            'template': '<div class="popover hidden-xs" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',
            'delay': { show: 0, hide: 0 },
        });

        /*     window.setInterval(function () {
                 $('.breathe').animate({
                     fontSize: "12px"
                 }, 200).animate({
                     fontSize: "14px"
                 }, 500).delay(300);
             }, 1);*/

    });
</script>

@{

    var identifier = Model.First().identifier;
    List<string> concatList = new List<string>();
    List<string> concatListFinal = new List<string>();
    List<PoetryClass> pt = new List<PoetryClass>();
    List<Publish> mypt = findMeter.returnMyPoetry();
    int finalID = 0;

    if (!String.IsNullOrEmpty(Model.First().meterName))
    {
        List<string> lst = new List<string>();
        foreach (var item in Model)
        {
            if (lst.Count == 0)
            {
                lst.Add(item.meterName);
            }
            bool flag = true;
            foreach (var m in lst)
            {
                if (m.Equals(item.meterName))
                {
                    flag = false;
                    break;
                }
            }
            if (flag)
            {
                lst.Add(item.meterName);
            }
        }

        //average meter score calculation
        double[] scoreList = new double[lst.Count];
        int[] itemOrder = new int[lst.Count];


        for (int m = 0; m < lst.Count; m++)
        {
            double count = 0.0d;
            foreach (var x in Model)
            {
                if (lst[m].Equals(x.meterName))
                {
                    count += 1.0d;
                }
            }
            scoreList[m] = count;
            itemOrder[m] = m;
        }

        Array.Sort(scoreList, itemOrder);
        Array.Reverse(itemOrder);
        Array.Reverse(scoreList);

        List<string> finalList = new List<string>();

        for (int i = 0; i < lst.Count; i++)
        {
            finalList.Add(lst[itemOrder[i]]);
        }

        List<int> idList = new List<int>();
        for (int i = 0; i < finalList.Count; i++)
        {
            foreach (var m in Model)
            {
                if (m.meterName.Equals(finalList[i]))
                {
                    idList.Add(m.id);
                    break;
                }
            }
        }
        if (idList.Count != 0)
            finalID = idList.First();
        string meterName = "";
        meterName = finalList[0];

        int k = 0;
        for (int i = 0; i < idList.Count; i++)
        {
            string temp = "";
            string temp2 = "";
            for (int j = i + 1; j < idList.Count; j++)
            {
                if ((idList[i] == idList[j]) && (idList[j] != -100))
                {
                    idList[j] = -100;
                    temp += " || " + finalList[j].ToString() + " | " + scoreList[j].ToString();
                    temp2 += "|" + finalList[j].ToString();
                }
            }
            if (idList[i] != -100)
            {
                concatList.Add(finalList[i].ToString() + " | " + scoreList[i].ToString() + temp);
                concatListFinal.Add(finalList[i].ToString() + temp2);
            }
        }
        pt = findMeter.returnPoetry(meterName);
    }
}


<style>
    .green {
        color: #00ff21;
    }
</style>



<div class="container urdu px-0">
    <div class="row justify-content-center">
        <div class="col col-lg-12 col-sm-12 col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb urdu-small hidden-xs">
                    <li class="breadcrumb-item"><a href="/home">عروض</a></li>
                    <li class="breadcrumb-item"><a href="/create">اصلاح</a></li>
                    <li class="breadcrumb-item active" aria-current="page">نتیجہ</li>
                </ol>
            </nav>
        </div>
    </div>
    <div class="row">
        <div class="col col-lg-12 col-sm-12 col-md-12">
            <div class="alert alert-danger text-right" hidden="hidden">
                یہ بٹن دبانے سے پہلے مصرعوں میں تبدیلیاں کرنا ضروری ہیں
            </div>
            @*<div class="alert alert-warning">
            <p class="urdu">
                اطلاع: اپنی شاعری شائع کرنے یا مستقل لنک بنانے کے لئے تقطیع سیکشن کے نتیجے میں دیئے گئے اس بٹن کو دبائیں:
                <div class="btn btn-sm btn-default" id="linkbutton2"><span class="glyphicon glyphicon-link"> </span></div>

            </p>

        </div>*@


            @*<div class="row">
                <div class="col col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="alert alert-info right-align alert-dismissible">
                        <p class="urdu-medium text-right">
                            اطلاع: ہر سال ہمیں عروض سائٹ کو اچھی سپیڈ پر چلانے کے لئے ہوسٹنگ سرور کے لئے اخراجات برداشت کرنے ہوتے ہیں۔آپ بھی اس سائٹ کو بخوبی چلانے میں ہم سے  <a class="btn btn-outline-info" href="https://donorbox.org/aruuz">  تعاون </a> کریں۔
                            بہت شکریہ۔
                        </p>
                        <p align="center">
                            <progress id="pbar33" max="100" value="52"></progress>
                            کل تعاون: 403/770$
                        </p>
                    </div>
                </div>
            </div>*@

        </div>
    </div>
    <div class="main main-raised2 col-md-12 col-12 px-0 justify-content-center mx-auto">
        @* @await Component.InvokeAsync("AdComponent")
        <div class="pt-2">
        </div>*@
        <div class="row justify-content-center">
            <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card bg-light  ">
                    <div class="card-header hidden-xs py-0">
                        <div class="row my-1 py-0">
                            <div class="col col-lg-12 col-sm-12 col-md-12 col-xs-12 hidden-xs hidden-sm float-left text-left">
                                <img src="~/icons/create.png" width="40" height="40" class="float-left my-1">
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col col-lg-12 col-sm-12 col-md-12">
                                <div class="row">
                                    <div class="col-lg-12 col-sm-12 col-md-12">
                                        <div>
                                            <div class="table-responsive">
                                                <table class="table table-hover" align="right" id="outputTable">
                                                    @{if (String.IsNullOrEmpty(Model.First().meterName))
                                                        {
                                                            <tr>
                                                                <td colspan="3" class="warning">
                                                                    <p class="urdu text-right"> کوئی مانوس بحر نہیں مل سکی۔@Html.ActionLink("مضامین", "Index", "Resources") پر کلک کریں یا پھر رپورٹ کریں </p>
                                                                    <a href="/resources/article/19">
                                                                        اکثر پوچھے جانے والے سوالات دیکھیں۔
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        }
                                                    }

                                                    @{
                                                        var id = 0;
                                                        foreach (var item in Model)
                                                        {
                                                            if (!String.IsNullOrEmpty(item.meterName))
                                                            {
                                                                if (!item.hidden)
                                                                {
                                                                    string sectionID = "-" + item.meterName.Replace(" ", "_").Replace("/", "").Replace("(", "").Replace(")", "").ToString() + "-" + id.ToString() + "_Score_" + item.score.ToString();
                                                                    int[] colspan = new int[item.wordTaqti.Count];
                                                                    int k = 0;
                                                                    for (int i = 0; i < item.wordTaqti.Count; i++)
                                                                    {
                                                                        colspan[i] = item.wordTaqti[i].Replace("(", "").Replace(")", "").Replace("[", "").Replace("]", "").Length;
                                                                    }


                                                                    <tbody id="section0_@sectionID">
                                                                        @if (item.score == 0)
                                                                        {
                                                                            <tr>
                                                                                <td colspan="1" class="text-right">
                                                                                    روانی سکور:
                                                                                </td>
                                                                                <td colspan="1" class="text-right">
                                                                                    @Html.DisplayFor(metername => item.rhythmScore)
                                                                                </td>
                                                                            </tr>
                                                                        }
                                                                        <tr class="table-primary">
                                                                            <td colspan="4" class="success urdu-small text-right">
                                                                                @if (findMeter.find(item.meterName))
                                                                                {
                                                                                    <a class="breathe" target="_blank" href="/selection/meters?meter=@item.meterName">  @Html.DisplayFor(metername => item.meterName)  </a>
                                                                                }
                                                                                else
                                                                                {
                                                                                    @Html.DisplayFor(metername => item.meterName)
                                                                                }
                                                                            </td>
                                                                        </tr>

                                                                        @if ((item.score == 0 && item.id <= -2) || item.score != 0)
                                                                        {
                                                                            <tr class="table-secondary">
                                                                                <td colspan="4" class="success urdu-medium text-right" align="right">

                                                                                    @Html.DisplayFor(metername => item.feet)

                                                                                </td>
                                                                            </tr>
                                                                        }
                                                                    </tbody>
                                                                    <tbody id="section3_@sectionID">
                                                                        <tr class="info" data-placement="left" title="تجرباتی فیچر (اغلاط ممکن ہیں)">
                                                                            @foreach (var m in item.feetList)
                                                                            {
                                                                                <td align="right" colspan="2">
                                                                                    @Html.DisplayFor(modelItem => m.foot)
                                                                                </td>
                                                                            }
                                                                        </tr>

                                                                        <tr class="info" data-placement="left" title="تجرباتی فیچر (اغلاط ممکن ہیں)">


                                                                            @foreach (var m in item.feetList)
                                                                            {
                                                                                int i = 0;
                                                                                <td align="right" colspan="2">

                                                                                    @foreach (var l in m.words)
                                                                                    {
                                                                                        if (i % 2 == 0)
                                                                                        {
                                                                                            <font color="blue">
                                                                                                @Html.DisplayFor(modelItem => l)
                                                                                            </font>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <font color="magenta">
                                                                                                @Html.DisplayFor(modelItem => l)
                                                                                            </font>
                                                                                        }
                                                                                        i++;
                                                                                    }


                                                                                </td>
                                                                            }
                                                                        </tr>


                                                                    </tbody>
                                                                    <tbody id="section1_@sectionID">
                                                                        <tr id="row0_@sectionID" class="active urdu-small">

                                                                            <th colspan="1"> <a class="text-primary" onclick="rowClicked('row0_@sectionID')">تدوین</a></th>

                                                                            @foreach (var m in item.words)
                                                                            {
                                                                                if (m.error)
                                                                                {
                                                                                    if (m.id[0] != -1 && !m.modified)
                                                                                    {
                                                                                        <td align="right" onclick="wordClicked('@m.word')" colspan="@colspan[k]">
                                                                                            <a href="#">

                                                                                                <font color="red">
                                                                                                    <u>
                                                                                                        @Html.DisplayFor(modelItem => m.word)
                                                                                                    </u>
                                                                                                </font>

                                                                                            </a>
                                                                                        </td>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        if (m.code.Count > 0)
                                                                                        {
                                                                                            if (m.code[0].Equals("---"))
                                                                                            {
                                                                                                <td align="right" onclick="wordClicked('---')" colspan="@colspan[k]">
                                                                                                    <font color="red">
                                                                                                        <span style="border-bottom: 1px dotted #ff0000;padding:1px">
                                                                                                            <span style="border-bottom: 1px dotted #ff0000;">
                                                                                                                @Html.DisplayFor(modelItem => m.word)
                                                                                                            </span>
                                                                                                        </span>
                                                                                                    </font>
                                                                                                </td>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <td align="right" colspan="@colspan[k]">
                                                                                                    <font color="red">
                                                                                                        @Html.DisplayFor(modelItem => m.word)
                                                                                                    </font>
                                                                                                </td>
                                                                                            }
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td align="right" colspan="@colspan[k]">
                                                                                                <font color="red">

                                                                                                    @Html.DisplayFor(modelItem => m.word)

                                                                                                </font>

                                                                                            </td>


                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {

                                                                                    if (m.id[0] != -1 && !m.modified)
                                                                                    {
                                                                                        if (m.grafted == true)
                                                                                        {
                                                                                            <td align="right" onclick="wordClicked('@m.word')" colspan="@colspan[k]">
                                                                                                <a href="#">
                                                                                                    <font color="orange">
                                                                                                        <u>
                                                                                                            @Html.DisplayFor(modelItem => m.word)
                                                                                                        </u>
                                                                                                    </font>

                                                                                                </a>
                                                                                            </td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td align="right" onclick="wordClicked('@m.word')" colspan="@colspan[k]">
                                                                                                <a href="#">
                                                                                                    <font color="green">
                                                                                                        <u>
                                                                                                            @Html.DisplayFor(modelItem => m.word)
                                                                                                        </u>
                                                                                                    </font>

                                                                                                </a>
                                                                                            </td>
                                                                                        }

                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        if (m.code.Count > 0)
                                                                                        {
                                                                                            if (m.code[0].Equals("---"))
                                                                                            {
                                                                                                <td align="right" onclick="wordClicked('---')" colspan="@colspan[k]">
                                                                                                    <font color="green">

                                                                                                        <span style="border-bottom: 1px dotted #ff0000;padding:1px">
                                                                                                            <span style="border-bottom: 1px dotted #ff0000;">
                                                                                                                @Html.DisplayFor(modelItem => m.word)
                                                                                                            </span>
                                                                                                        </span>
                                                                                                    </font>
                                                                                                </td>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                if (m.grafted == true)
                                                                                                {
                                                                                                    <td class="right-align active" colspan="@colspan[k]">
                                                                                                        <font color="orange">
                                                                                                            @Html.DisplayFor(modelItem => m.word)
                                                                                                        </font>
                                                                                                    </td>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <td class="right-align active" colspan="@colspan[k]">
                                                                                                        <font color="green">
                                                                                                            @Html.DisplayFor(modelItem => m.word)
                                                                                                        </font>
                                                                                                    </td>
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            if (m.grafted == true)
                                                                                            {
                                                                                                <td align="right" colspan="@colspan[k]">

                                                                                                    <font color="orange">
                                                                                                        @Html.DisplayFor(modelItem => m.word)

                                                                                                    </font>
                                                                                                </td>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <td align="right" colspan="@colspan[k]">

                                                                                                    <font color="green">
                                                                                                        @Html.DisplayFor(modelItem => m.word)

                                                                                                    </font>
                                                                                                </td>
                                                                                            }

                                                                                        }
                                                                                    }

                                                                                }

                                                                                k += 1;

                                                                            }
                                                                        </tr>


                                                                        <tr>
                                                                            <th align="right" class="urdu-medium"> تقطیع:</th>


                                                                            @{ k = 0;}
                                                                            @foreach (var m in item.orignalTaqti)
                                                                            {
                                                                                <td align="right" class="urdu-naskh" colspan="@colspan[k]">
                                                                                    @Html.DisplayFor(modelItem => m)
                                                                                </td>

                                                                                k += 1;

                                                                            }
                                                                        </tr>


                                                                        @{k = 0;}
                                                                        <tr>

                                                                            <th align="right" class="urdu-medium"> اصلاح:</th>



                                                                            @foreach (var m in item.wordTaqti)
                                                                            {
                                                                                <td align="right" colspan="@colspan[k]" class="urdu-naskh">
                                                                                    @Html.DisplayFor(modelItem => m)
                                                                                </td>

                                                                                k += 1;

                                                                            }
                                                                        </tr>
                                                                    </tbody>
                                                                    <tbody id="section2_@sectionID">
                                                                        <tr>
                                                                            <th align="right" class="urdu-small"> بحر:</th>

                                                                            @foreach (var m in item.meterSyllables)
                                                                            {

                                                                                <td align="right" class="urdu-naskh">
                                                                                    @Html.DisplayFor(modelItem => m)
                                                                                </td>

                                                                            }
                                                                        </tr>
                                                                        <tr>
                                                                            <th align="right" class="urdu-small"> تقطیع:</th>
                                                                            @foreach (var m in item.codeSyllables)
                                                                            {
                                                                                <td align="right" class="urdu-naskh">
                                                                                    @Html.DisplayFor(modelItem => m)
                                                                                </td>
                                                                            }
                                                                        </tr>


                                                                    </tbody>

                                                                    id++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="card-footer urdu">

                        <a href="#" class="pull-left" onclick="reportClicked(@identifier)"> رپورٹ</a>
                    </div>
                </div>
                @if (pt.Count > 0)
                {
                    <div class="card   border-bottom-0">
                        <div class="card-body">
                            <div class="urdu-large text-right">
                                <p class="urdu-large text-right">
                                    اسی بحر میں کلام
                                </p>
                                <span class="fa fa-chevron-down"></span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="pt-2">
    </div>
    <div class="main main-raised2 col-md-12 col-12 px-0 justify-content-center mx-auto">

        @foreach (var m in pt)
        {
            await Html.RenderPartialAsync("_PartialSelection", m);
            <div class="pt-2">
            </div>
        }
    </div>


</div>


<div class=" container">
    <nav class="navbar navbar-expand fixed-bottom navbar-light bg-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsebarcreate" aria-controls="collapsebarcreate" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsebarcreate">
            <ul class="navbar-nav mx-auto mt-2 mt-lg-0t">
                <li class="nav-item">
                    <div class="btn-group btn-group-toggle float-right" data-toggle="buttons" onchange="validate_create()" dir="rtl">
                        <label class="btn btn-outline-primary btn-default " data-toggle="popover" data-content="تفصیلات دیکھنے کے لیے یہاں کلک کریں" data-title="ہدایات">
                            <i class="fa fa-plus"></i>
                            <input class="urdu" type="radio" name="options" id="option1">
                        </label>

                        <label class="btn btn-outline-primary btn-default active" data-toggle="popover" data-content="تفصیلات چھپانے کے لیے یہاں کلک کریں" data-title="ہدایات">
                            <i class="fa fa-minus"></i>
                            <input class=" urdu" type="radio" name="options" id="option2" checked="checked">
                        </label>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="btn btn-default btn-outline-info float-right" id="infoBtn" onclick="infoClicked(5)" data-toggle="popover" data-content="نتیجے میں استعمال ہونے والے نشانات  کی تفصیل دیکھنے کے لیے یہاں کلک کریں" data-title="ہدایات">
                        <i class="fa fa-info"></i>
                    </div>
                </li>

                <li class="nav-item">
                    <div class="btn btn-default btn-outline-primary float-right" id="dictionaryBtn" onclick="dictionaryClicked()" data-toggle="popover" data-content="کسی لفظ کی تقطیع معلوم کرنے کے لئے یہاں پر کلک کریں" data-title="ہدایات">
                        <i class="fa fa-book"></i>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="btn btn-default btn-outline-success float-right" id="saveBtn" onclick="saveClicked()" data-toggle="popover" data-content="تبدیلیاں محفوظ کریں" data-title="ہدایات">
                        <i class="fa fa-save" id="saveicon"></i>
                    </div>
                </li>

                <li class="nav-item">
                    <div class="btn btn-default btn-outline-primary float-right" id="abc" onclick="taqtiClicked()">
                        <div data-toggle="popover" data-content="دوبارہ تقطیع کرنے کے لیے یہاں کلک کریں" data-title="ہدایات">
                            <i class="fa fa-refresh"></i>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
</div>
